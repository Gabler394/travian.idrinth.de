{% include 'header.twig' %}
<script type="text/javascript" src="/chart.min.js"></script>
<script type="text/javascript" src="/chartjs-adapter-date-fns.bundle.min.js"></script>
<h2>{{ translations.troop_tool }}</h2>
{% set lastWorld='' %}
{% for world,tribes in troops %}
    <h3>{{ world }}</h3>
    {% for tribe,villages in tribes %}
        <h4>{{ translations[tribe ~ 's'] }}</h4>
        <form method="post">
            <table class="collapsed-table">
                <tr>
                    <th>Village</th>
                    <th>{{ translations[tribe ~ '_soldier1'] }}</th>
                    <th>{{ translations[tribe ~ '_soldier2'] }}</th>
                    <th>{{ translations[tribe ~ '_soldier3'] }}</th>
                    <th>{{ translations[tribe ~ '_soldier4'] }}</th>
                    <th>{{ translations[tribe ~ '_soldier5'] }}</th>
                    <th>{{ translations[tribe ~ '_soldier6'] }}</th>
                    <th>{{ translations[tribe ~ '_ram'] }}</th>
                    <th>{{ translations[tribe ~ '_catapult'] }}</th>
                    <th>{{ translations[tribe ~ '_settler'] }}</th>
                    <th>{{ translations[tribe ~ '_chief'] }}</th>
                    <th>{{ translations.hero }}</th>
                    <th>{{ translations.tournament_square }}</th>
                </tr>
                {% for village in villages %}
                    <tr>
                        <th><a href="https://{{ village.world }}/position_details.php?x={{ village.x }}&y={{ village.y }}" target="_blank">{{ village.name }} ({{ village.x }}|{{ village.y }})</a></th>
                        <td>{{ village.soldier1 }}</td>
                        <td>{{ village.soldier2 }}</td>
                        <td>{{ village.soldier3 }}</td>
                        <td>{{ village.soldier4 }}</td>
                        <td>{{ village.soldier5 }}</td>
                        <td>{{ village.soldier6 }}</td>
                        <td>{{ village.ram }}</td>
                        <td>{{ village.catapult }}</td>
                        <td>{{ village.settler }}</td>
                        <td>{{ village.chief }}</td>
                        <td>{{ village.hero }}</td>
                        <td>{{ village.tournament_square }}</td>
                    </tr>
                {% endfor %}
            </table>
        </form>
        <canvas id="chart-{{ world|replace({'.': '-'}) }}"></canvas>
        <script>
          new Chart('chart-{{ world|replace({'.': '-'}) }}', {
            type: 'line',
            options: {
              scales: {
                y: {
                  stacked: true,
                  show: true,
                },
                x: {
                  type: 'timeseries',
                  time: {
                    unit: 'day'
                  }
                },
              }
            },
            data: {
              labels: {{ charts[world].labels|json_encode()|raw }},
              datasets: [{
                label: 'Offence',
                data: {{ charts[world].offence|json_encode()|raw }},
                fill: true,
                borderColor: 'rgb(192, 75, 75)',
                backgroundColor: 'rgb(192, 75, 75, 0.5)',
                tension: 0.1
              },{
                label: 'Multifunctional',
                data: {{ charts[world].multi|json_encode()|raw }},
                fill: true,
                borderColor: 'rgb(192, 75, 192)',
                backgroundColor: 'rgb(192, 75, 192, 0.5)',
                tension: 0.1
              },{
                label: 'Defence',
                data: {{ charts[world].defence|json_encode()|raw }},
                fill: true,
                borderColor: 'rgb(75, 75, 192)',
                backgroundColor: 'rgb(75, 75, 192, 0.5)',
                tension: 0.1
              },{
                label: 'Scouts',
                data: {{ charts[world].scouts|json_encode()|raw }},
                fill: true,
                borderColor: 'rgb(75, 192, 75)',
                backgroundColor: 'rgb(75, 192, 75, 0.5)',
                tension: 0.1
              },]
            }
          });
        </script>
    {% endfor %}
{% else %}
    <p>{{ translations.no_data }}</p>
{% endfor %}
{% include 'footer.twig' %}